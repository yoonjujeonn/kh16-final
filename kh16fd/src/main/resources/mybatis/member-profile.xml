<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="memberProfile">
  
  	<insert id="insertAttachment" parameterType="com.kh.fd.vo.MemeberProfileVO">
		<selectKey keyProperty="attachmentNo" resultType="int" order="BEFORE">
			select attachment_seq.nextval from dual
		</selectKey>
		insert into 
		attachment (
			attachment_no, origin_name, file_path
		) 
		values (
			#{attachmentNo}, #{profileName}, #{profileLink}
		)
  	</insert>
  	
  	<insert id="insertMemberProfile" parameterType="com.kh.fd.vo.MemberProfileVO">
  		insert into member_profile (
  			member_id, attachment_no
  		) values (
  			#{memberId}, #{attachmentNo}
  		)
  	</insert>
  	
  	<update id="updateAndInsertMemberProfile" parameterType="com.kh.fd.vo.MemberProfileVO">
  		merge into member_profile p
  		using dual
  		on (p.member_id = #{memberId})
  		when matched then
  			update set p.attachment_no=#{attachmentNo}
  		when not matched then
  			insert (member_id, attachment_no)
  			values (#{memberId}, #{attachmentNo})
  	</update>
  	
  
	<select id="selectAttachmentNoByMemberId"  parameterType="com.kh.fd.vo.MemeberProfileVO">
		select
			p.member_id,
			p.attachment_no,
			a.origin_name as profileName, a.file_path as profileLink from
			member_profile p
		join
			attachment a on p.attachment_no a.attachment_no
		where
			p.member_id = #{memberId}
	</select>
	
	<delete id="deleteByMemberId" parameterType="string">
		delete from member_profile
		where member_id = #{member_id}
	</delete>
  
  	
  
  
</mapper>